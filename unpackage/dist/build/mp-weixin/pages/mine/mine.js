(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/mine"],{"1b8b":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("a34a"));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return c(e)||i(e,t)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done);r=!0)if(n.push(s.value),t&&n.length===t)break}catch(c){a=!0,o=c}finally{try{r||null==i["return"]||i["return"]()}finally{if(a)throw o}}return n}function c(e){if(Array.isArray(e))return e}function u(e,t,n,r,a,o,s){try{var i=e[o](s),c=i.value}catch(u){return void n(u)}i.done?t(c):Promise.resolve(c).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function s(e){u(o,r,a,s,i,"next",e)}function i(e){u(o,r,a,s,i,"throw",e)}s(void 0)})}}function f(e){return d(e)||p(e)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function p(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function d(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}var g=function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"4996"))},v=1,m={components:{uniPopup:g},onLoad:function(){e.hideTabBar()},data:function(){return{title:"Hello",fullScreen:getApp().globalData.fullScreen,opacity:"",navlist:[],sort:!0,url:n("a842"),canvasH:"780px",userInfo:{nickname:"",avatar:""},qr_code_img:""}},onShow:function(){this.showUserInfo();var t=e.getStorageSync("userinfo");t&&1!=t.isuser?(this.navlist=f(getApp().globalData.navbar_admin),this.sort=!1):(this.navlist=f(getApp().globalData.navbar_user),this.sort=!0);var n=getApp().globalData.visited||!1;n&&(this.qr_code(),getApp().globalData.visited=!1)},methods:{base64src:function(){var t=l(r.default.mark(function t(n){var a,s,i,c,u,l,f,h;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=e.getFileSystemManager(),s="tmp_base64src"+v,v++,i=/data:image\/(\w+);base64,(.*)/.exec(n)||[],c=o(i,3),u=c[1],l=c[2],console.log("format,",u),u||reject(new Error("ERROR_BASE64SRC_PARSE")),f="".concat(wx.env.USER_DATA_PATH,"/").concat(s,".").concat(u),h=e.base64ToArrayBuffer(l),a.writeFileSync(f,h,"binary"),console.log("writeFile",f),t.abrupt("return",f);case 11:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),qr_code:function(){var t=l(r.default.mark(function t(){var n,a,o,s;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.$refs.popup.open(),n=e.getStorageSync("userinfo"),this.userInfo.nickname=n.nickname,this.userInfo.avatar=n.avatar,t.next=6,e.request({method:"GET",url:"http://wxhf.var365.cn/api/wechat/qrcode?userid="+n.userid});case 6:return a=t.sent,console.log("qrcode",a),o=a.slice(-1)[0].data,console.log("base64___01",o),t.next=12,this.base64src(o);case 12:return s=t.sent,t.next=15,this.createQrCode(s);case 15:this.qr_code_img=o;case 16:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),editUserImage:function(){e.navigateTo({url:"/pages/personalData/personalData"})},showUserInfo:function(){this.userInfo=e.getStorageSync("userinfo"),console.log(this.userInfo)},add_kp:function(){var t=l(r.default.mark(function t(){var n,a,o;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=this,t.next=3,e.canvasToTempFilePath({x:0,y:0,canvasId:"firstCanvas",fileType:"jpg",quality:.8});case 3:return a=t.sent,console.log("res",a,a.slice(-1)[0].tempFilePath),t.next=7,e.saveImageToPhotosAlbum({filePath:a.slice(-1)[0].tempFilePath});case 7:o=t.sent,console.log("res2",o,o.slice(-1)[0].errMsg),"saveImageToPhotosAlbum:ok"==o.slice(-1)[0].errMsg?(console.log("save success"),n.$refs.popup.close()):e.showModal({title:"提示",content:"需要您授权保存相册",showCancel:!1,success:function(t){e.openSetting({success:function(t){t.authSetting["scope.writePhotosAlbum"]?e.showModal({title:"提示",content:"获取权限成功,再次点击图片即可保存",showCancel:!1}):e.showModal({title:"提示",content:"获取权限失败，将无法保存到相册哦~",showCancel:!1}),n.$refs.popup.close()}})}});case 10:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),drawRoundRect:function(e,t,n,r,a,o){e.beginPath(),e.arc(t+o,n+o,o,Math.PI,3*Math.PI/2),e.lineTo(r-o+t,n),e.arc(r-o+t,o+n,o,3*Math.PI/2,2*Math.PI),e.lineTo(r+t,a+n-o),e.arc(r-o+t,a-o+n,o,0,1*Math.PI/2),e.lineTo(o+t,a+n),e.arc(o+t,a-o+n,o,1*Math.PI/2,Math.PI),e.closePath(),e.setFillStyle("#FFFFFF"),e.fill()},circleImg:function(e,t){e.save(),e.beginPath(),e.arc(95,150,25,0,2*Math.PI,!1),e.fill(),e.clip(),e.drawImage(t,0,0,320,320,50,105,80,80),e.restore()},getGoodsImgPath:function(){var t=l(r.default.mark(function t(n){var a;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=new Promise(function(t,r){e.getImageInfo({src:n,success:t,fail:t})}),t.abrupt("return",a);case 2:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),createQrCode:function(){var t=l(r.default.mark(function t(n){var a,o,s,i,c,u,l;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=e.getSystemInfoSync(),o=a.windowWidth,a.windowHeight,s=e.createCanvasContext("firstCanvas"),console.log("base64__02",this.url),t.next=5,this.base64src(this.url);case 5:return i=t.sent,console.log("base__over",i),t.next=9,this.getGoodsImgPath(i);case 9:c=t.sent,console.log("base__over2",c),s.rect(0,0,o,780),s.setFillStyle("#C9AB79"),s.fill(),s.drawImage(c.path,40,33,160,40),this.drawRoundRect(s,40,110,o-80,400,10);try{s.beginPath(),s.setFontSize(16),s.setFillStyle("#333333"),s.fillText("".concat(this.userInfo.nickname),130,160)}catch(r){console.log(r)}return t.next=19,this.getGoodsImgPath(n);case 19:return u=t.sent,console.log("base__over3",u),s.drawImage(u.path,120,200,170,170),s.beginPath(),s.setFontSize(20),s.setFillStyle("#999999"),s.fillText("长按识别或扫码进入包铺鉴定",60,440),s.fill(),t.next=29,this.getGoodsImgPath(this.userInfo.avatar);case 29:l=t.sent,this.circleImg(s,l.path),s.draw();case 32:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}()},onPageScroll:function(e){e.scrollTop>1?this.opacity="background: linear-gradient(to top,#35363B "+5*e.scrollTop+"%,transparent 100%)":this.opacity=""},onShareAppMessage:function(t){var n=e.getStorageSync("userinfo"),r=n.avatar;n.nickname;return{title:"包铺",path:"pages/index/index",imageUrl:r,desc:"箱包鉴定小程序",success:function(e){console.log(e),that.$refs.popup.close()},fail:function(e){console.log(e),that.$refs.popup.close()}}}};t.default=m}).call(this,n("543d")["default"])},4415:function(e,t,n){"use strict";(function(e){n("5605"),n("921b");r(n("66fd"));var t=r(n("89f4"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"634c":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a})},"703d":function(e,t,n){"use strict";var r=n("979d"),a=n.n(r);a.a},"89f4":function(e,t,n){"use strict";n.r(t);var r=n("634c"),a=n("f13c");for(var o in a)"default"!==o&&function(e){n.d(t,e,function(){return a[e]})}(o);n("703d");var s=n("2877"),i=Object(s["a"])(a["default"],r["a"],r["b"],!1,null,"4b2b1430",null);t["default"]=i.exports},"979d":function(e,t,n){},f13c:function(e,t,n){"use strict";n.r(t);var r=n("1b8b"),a=n.n(r);for(var o in r)"default"!==o&&function(e){n.d(t,e,function(){return r[e]})}(o);t["default"]=a.a}},[["4415","common/runtime","common/vendor"]]]);